"use strict";
require("regenerator-runtime/runtime");
var _gsap = _interopRequireDefault(require("gsap"));
var _Dreams = require("./vendor/Dreams");
var _core = _interopRequireDefault(require("@barba/core"));
var _Page = _interopRequireDefault(require("./Page"));
var _Preloader = _interopRequireDefault(require("./Page/components/Preloader"));
function _interopRequireDefault(obj) {
    return obj && obj.__esModule ? obj : {
        default: obj
    };
}
// Import Runtime & GSAP
// Import Modules
// Define Global Variables
window.$ = _Dreams.dream;
window.gsapDefaults = {
    defaults: {
        ease: 'power1.inOut'
    }
}; // Define Module Global Variables
let slide, page; // Insert Slide In Page
const insertSlide = ()=>{
    // Create Slide Element
    slide = $.html('<div class="page-transition-slide"><div class="preloader__content"><svg><use xlink:href="img/icons.svg#logo"></use></svg><span class="preloader__spinner"></span></div></div>'); // Append Slide Element
    page.elements.body.append(slide);
}; // Define Function to refresh page
const refreshPageEvents = (_ref)=>{
    let { next  } = _ref;
    page.destroy();
    page = new _Page.default({
        barba: _core.default,
        container: next.container
    }).init();
}; // Start Page Functions
const startPage = (data)=>{
    // Start Page Events
    page.start(); // Get Video Backgrounds
    const videos = $(data ? data.next.container : 'main').children('.bg-video'); // Return if no videos on the page
    if (!videos.length) return; //Autoplay Videos After transition
    videos.children('video[autoplay]').forEach((video)=>video.play()
    ); // Add Ready Class To Videos
    videos.addClass('ready');
}; // Start Load Page
window.addEventListener('DOMContentLoaded', ()=>{
    // Create New Page
    page = new _Page.default({
        barba: _core.default
    }).init(); // Create Preloader
    new _Preloader.default().after(startPage).init(); // Initialize Barba.JS
    _core.default.init({
        // Define Page Transition
        transitions: [
            {
                name: 'default-transition',
                // Animate Slide Into Place
                leave () {
                    return new Promise((resolve)=>{
                        const tl = _gsap.default.timeline(gsapDefaults);
                        tl.to(slide.e(), {
                            y: 0,
                            duration: 0.5
                        });
                        tl.eventCallback('onComplete', resolve);
                    });
                },
                // Animate Slide Away to reveal new page
                enter () {
                    return new Promise((resolve)=>{
                        const tl = _gsap.default.timeline(gsapDefaults);
                        tl.to(slide.children('.preloader__content').e(), {
                            duration: 0.5,
                            opacity: 0
                        });
                        tl.to(slide.e(), {
                            duration: 0.5,
                            y: '-100vh'
                        });
                        tl.eventCallback('onComplete', resolve);
                    });
                }
            }
        ],
        // Register JavaScript Components For Different Pages
        views: [
            {
                namespace: 'home',
                beforeEnter (_ref2) {
                    let { next  } = _ref2;
                    page.addComponent('Typewriter', 'ContactForm', {
                        name: 'DraggableSlider',
                        data: {
                            selector: '.reviews__carousel',
                            activeClass: 'dragging'
                        }
                    });
                }
            },
            {
                namespace: 'services',
                beforeEnter () {
                    page.addComponent('ContactForm');
                }
            },
            {
                namespace: 'about',
                beforeEnter () {
                    page.addComponent('ContactForm');
                }
            },
            {
                namespace: 'fleet',
                beforeEnter () {
                    page.addComponent('ContactForm');
                }
            },
            {
                namespace: 'login',
                beforeEnter () {
                    // Apply Navbar Theme Changes
                    page.navbar.applyTheme([
                        {
                            brand: 'jet'
                        },
                        {
                            media: 'mobile',
                            brand: 'white'
                        }
                    ]).forceLayout('tablet'); // Add Auth Form Component
                    page.addComponent({
                        name: 'AuthForm',
                        data: {
                            page,
                            selector: '#login-form'
                        }
                    });
                }
            },
            {
                namespace: 'booking',
                beforeEnter () {
                    // Apply Navbar Theme Changes
                    page.navbar.applyTheme([
                        {
                            brand: 'jet'
                        }
                    ]).forceLayout('mobile'); // Add Booking App Component
                    page.addComponent({
                        name: 'BookingApp',
                        data: {
                            page,
                            selector: '#root'
                        }
                    });
                }
            }
        ],
        // Prevent Double Clicking Links
        preventRunning: true,
        // Prevent Defalut Link Actions
        prevent: (_ref3)=>{
            let { el  } = _ref3;
            return el.classList && el.classList.contains('prevent');
        }
    }); // Attach Global Barba Hooks
    _core.default.hooks.beforeLeave(insertSlide);
    _core.default.hooks.afterLeave(refreshPageEvents);
    _core.default.hooks.after(startPage);
});
